<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartTour.JO - Ø§ÙƒØªØ´Ù Ø§Ù„Ø£Ø±Ø¯Ù† Ø¨Ø°ÙƒØ§Ø¡</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* --- Base & Reset --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            line-height: 1.6;
            color: #ffffff;
            background-color: #0f0f10;
            overflow-x: hidden;
        }
        
        html[lang="ar"] body { font-family: 'Cairo', sans-serif; }
        html[lang="en"] body { font-family: 'Poppins', sans-serif; }

        /* --- Global Styles & Utilities --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .section {
            padding: 6rem 0;
            position: relative;
        }

        .section:nth-child(even) {
            background-color: #111827;
        }

        .section-title {
            text-align: center;
            font-size: clamp(2.2rem, 5vw, 3rem);
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.2rem;
            color: #9ca3af;
            margin-bottom: 3rem;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #8b5cf6;
        }

        /* --- Navbar --- */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(15, 15, 16, 0.8);
            backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #8b5cf6;
            text-decoration: none;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-link {
            color: #d1d5db;
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .nav-link:hover, .nav-link.active {
            color: #ffffff;
            background: rgba(139, 92, 246, 0.2);
        }
        
        .lang-switcher button {
            background: none;
            border: 1px solid #4b5563;
            color: #d1d5db;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            transition: all 0.2s ease;
        }

        .lang-switcher button.active {
            background: #8b5cf6;
            color: white;
            border-color: #8b5cf6;
        }

        /* --- Hero Section --- */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1589493243452-90422a139199');
            background-size: cover;
            background-position: center;
        }

        .hero-content {
            max-width: 800px;
            padding: 0 2rem;
            animation: fadeInUp 1s ease-out;
        }
        
        .hero h1 {
            font-size: clamp(2.8rem, 5vw, 4.5rem);
            font-weight: 700;
            margin-bottom: 1rem;
            color: #ffffff;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .hero p {
            font-size: clamp(1.1rem, 2vw, 1.3rem);
            margin-bottom: 2rem;
            color: #f3f4f6;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* --- Chatbot --- */
        .chatbot-container {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 12px;
            padding: 2rem;
            backdrop-filter: blur(16px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        
        #chatWindow {
            background: #111827;
            border-radius: 8px;
            height: 400px;
            padding: 1rem;
            overflow-y: auto;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .chat-message {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            max-width: 80%;
            line-height: 1.5;
            white-space: pre-wrap; /* To respect newlines from AI */
        }
        
        .user-message {
            background-color: #8b5cf6;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
            html[dir="rtl"] & {
                align-self: flex-start;
                border-bottom-right-radius: 12px;
                border-bottom-left-radius: 2px;
            }
        }
        
        .bot-message {
            background-color: #374151;
            color: #f3f4f6;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
             html[dir="rtl"] & {
                align-self: flex-end;
                border-bottom-left-radius: 12px;
                border-bottom-right-radius: 2px;
            }
        }
        
        .chat-input-area {
            display: flex;
            gap: 1rem;
        }
        
        #chatInput {
            flex-grow: 1;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #4b5563;
            background-color: #1f2937;
            color: white;
            font-size: 1rem;
        }
        
        #sendButton {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        
        #sendButton:disabled {
            background: #583c9c;
            cursor: not-allowed;
        }

        /* --- General Card & Container Styles --- */
        .card-container {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 12px;
            padding: 2rem;
            backdrop-filter: blur(16px);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        #map {
            height: 500px;
            border-radius: 8px;
            z-index: 1;
        }

        .insights-grid, .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .insight-card, .category-card {
            background: #111827;
            border-radius: 12px;
            text-align: center;
            padding: 1.5rem;
            border: 1px solid rgba(75, 85, 99, 0.3);
            transition: all 0.3s ease;
        }

        .insight-card:hover, .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.15);
            border-color: #8b5cf6;
        }
        
        .category-card {
            padding: 0;
            overflow: hidden;
            text-align: start;
        }

        .category-image {
            height: 200px;
            background-size: cover;
            background-position: center;
        }
        
        .category-content {
            padding: 1.5rem;
        }
        
        .category-title {
            font-size: 1.3rem;
        }

        /* --- Back to Top & Modal --- */
        .back-to-top {
            position: fixed; bottom: 2rem; right: 2rem;
            width: 50px; height: 50px; border-radius: 50%; display: none;
            align-items: center; justify-content: center; z-index: 1000;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white; border: none; cursor: pointer;
            font-size: 1.5rem;
            html[dir="rtl"] & { right: auto; left: 2rem; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .nav-menu { display: none; } /* Add logic for mobile menu if needed */
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="nav-container container">
            <a class="logo" href="#hero" data-translate="siteTitle">SmartTour.JO</a>
            <ul class="nav-menu">
                <li><a class="nav-link active" href="#hero" data-translate="navHome"></a></li>
                <li><a class="nav-link" href="#chatbot" data-translate="navAIGuide"></a></li>
                <li><a class="nav-link" href="#insights" data-translate="navInsights"></a></li>
                <li><a class="nav-link" href="#map-section" data-translate="navMap"></a></li>
                <li><a class="nav-link" href="#categories" data-translate="navExplore"></a></li>
                <li class="lang-switcher">
                    <button id="lang-ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                    <button id="lang-en">English</button>
                </li>
            </ul>
            </div>
    </nav>

    <main>
        <section class="hero" id="hero">
            <div class="hero-content">
                <h1 data-translate="heroTitle"></h1>
                <p data-translate="heroSubtitle"></p>
                <div class="hero-buttons">
                    <a class="btn btn-primary" href="#chatbot" data-translate="heroBtnStart"></a>
                    <a class="btn btn-secondary" href="#categories" data-translate="heroBtnExplore"></a>
                </div>
            </div>
        </section>

        <section class="section" id="chatbot">
            <div class="container">
                <h2 class="section-title" data-translate="chatbotTitle"></h2>
                <p class="section-subtitle" data-translate="chatbotSubtitle"></p>
                <div class="chatbot-container">
                    <div id="chatWindow"></div>
                    <div class="chat-input-area">
                        <input id="chatInput" type="text" data-translate-placeholder="chatPlaceholder" />
                        <button id="sendButton" class="btn btn-primary" onclick="sendMessage()" data-translate="chatSend"></button>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="insights">
            <div class="container">
                <h2 class="section-title" data-translate="insightsTitle"></h2>
                <p class="section-subtitle" data-translate="insightsSubtitle"></p>
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-value">ğŸŒ¡ï¸ <span id="temp">--</span>Â°C</div>
                        <div class="insight-label" data-translate="insightTemp"></div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-value">ğŸ‘¥ <span id="crowd">--</span></div>
                        <div class="insight-label" data-translate="insightCrowd"></div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-value">ğŸ’§ <span id="humidity">--</span>%</div>
                        <div class="insight-label" data-translate="insightHumidity"></div>
                    </div>
                    <div class="insight-card">
                        <div class="insight-value">ğŸŒ¬ï¸ <span id="air-quality">--</span></div>
                        <div class="insight-label" data-translate="insightAir"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="ar-experience" class="section">
            <div class="container" style="text-align: center;">
                <h2 class="section-title" data-translate="arTitle"></h2>
                <p class="section-subtitle" data-translate="arSubtitle"></p>
                <a href="ar.html" class="btn btn-primary" data-translate="arBtn"></a>
            </div>
        </section>

        <section class="section" id="map-section">
            <div class="container">
                <h2 class="section-title" data-translate="mapTitle"></h2>
                <p class="section-subtitle" data-translate="mapSubtitle"></p>
                <div class="card-container">
                    <div id="map"></div>
                </div>
            </div>
        </section>

        <section class="section" id="categories">
            <div class="container">
                <h2 class="section-title" data-translate="categoriesTitle"></h2>
                <p class="section-subtitle" data-translate="categoriesSubtitle"></p>
                <div class="categories-grid">
                    </div>
            </div>
        </section>
    </main>
    
    <footer class="section" style="background: #0a0a0a; padding-bottom: 2rem;">
        <div class="container" style="text-align: center;">
             <p style="color: #6b7280; margin-top: 2rem; font-size: 0.9rem;" data-translate="footerRights"></p>
        </div>
    </footer>
    
    <button class="back-to-top" id="backToTop">â†‘</button>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // ===============================================
            // =========== 1. TRANSLATIONS & LANGUAGE ==========
            // ===============================================
            const translations = {
                en: {
                    siteTitle: "SmartTour.JO", navHome: "Home", navAIGuide: "AI Guide", navInsights: "Insights", arTitle: "Augmented Reality", arSubtitle: "Bring Jordan's history to life. Try our location-based AR experiences.", arBtn: "Launch AR Experience", navMap: "Map", navExplore: "Explore",
                    heroTitle: "Explore Jordan Smarter", heroSubtitle: "Discover Jordan's hidden treasures with AI-powered recommendations, real-time insights, and interactive experiences.", heroBtnStart: "Start Your Journey", heroBtnExplore: "Explore Categories",
                    chatbotTitle: "Ask Our Smart AI Guide", chatbotSubtitle: "Get instant answers about Jordan's attractions, travel times, and personalized recommendations.", chatPlaceholder: "Request a tour plan or ask anything...", chatSend: "Send",
                    insightsTitle: "Live Environment Insights", insightsSubtitle: "Real-time data from IoT sensors across Jordan's popular destinations.", insightTemp: "Temperature", insightCrowd: "Crowd Level", insightHumidity: "Humidity", insightAir: "Air Quality",
                    mapTitle: "Interactive Jordan Map", mapSubtitle: "Explore Jordan's attractions and plan your route with our interactive map.",
                    categoriesTitle: "Discover Jordan Your Way", categoriesSubtitle: "Choose from our curated categories to find experiences that match your interests.",
                    footerRights: "Â© 2024 SmartTour.JO. All rights reserved.",
                    // Popups and others
                    yourLocationPopup: "<b>Your Location</b>", welcomePopup: "Welcome to Jordan!", thinking: "...thinking"
                },
                ar: {
                    siteTitle: "SmartTour.JO", navHome: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", navAIGuide: "Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø°ÙƒÙŠ", navInsights: "Ù…Ø¤Ø´Ø±Ø§Øª Ø­ÙŠÙˆÙŠØ©", arTitle: "ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø²", arSubtitle: "Ø£Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø¯Ù† Ø¥Ù„Ù‰ Ø§Ù„Ø­ÙŠØ§Ø©. Ø¬Ø±Ù‘Ø¨ ØªØ¬Ø§Ø±Ø¨ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø² Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.", arBtn: "Ø´ØºÙ‘Ù„ ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù€ AR", navMap: "Ø§Ù„Ø®Ø±ÙŠØ·Ø©", navExplore: "Ø§ÙƒØªØ´Ù",
                    heroTitle: "Ø§ÙƒØªØ´Ù Ø§Ù„Ø£Ø±Ø¯Ù† Ø¨Ø°ÙƒØ§Ø¡", heroSubtitle: "Ø§ÙƒØªØ´Ù ÙƒÙ†ÙˆØ² Ø§Ù„Ø£Ø±Ø¯Ù† Ø§Ù„Ø®ÙÙŠØ© Ù…Ø¹ ØªÙˆØµÙŠØ§Øª Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ù„Ø­Ø¸ÙŠØ©ØŒ ÙˆØªØ¬Ø§Ø±Ø¨ ØªÙØ§Ø¹Ù„ÙŠØ©.", heroBtnStart: "Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ©", heroBtnExplore: "Ø§Ø³ØªÙƒØ´Ù Ø§Ù„ÙØ¦Ø§Øª",
                    chatbotTitle: "Ø§Ø³Ø£Ù„ Ù…Ø±Ø´Ø¯Ù†Ø§ Ø§Ù„Ø°ÙƒÙŠ", chatbotSubtitle: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø§Øª ÙÙˆØ±ÙŠØ© Ø­ÙˆÙ„ Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ø±Ø¯Ù†ØŒ Ø£ÙØ¶Ù„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø³ÙØ±ØŒ ÙˆØªÙˆØµÙŠØ§Øª Ø´Ø®ØµÙŠØ©.", chatPlaceholder: "Ø§Ø·Ù„Ø¨ Ø®Ø·Ø© Ø³ÙŠØ§Ø­ÙŠØ© Ø£Ùˆ Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡...", chatSend: "Ø£Ø±Ø³Ù„",
                    insightsTitle: "Ù…Ø¤Ø´Ø±Ø§Øª Ø¨ÙŠØ¦ÙŠØ© Ø­ÙŠØ©", insightsSubtitle: "Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­Ø¸ÙŠØ© Ù…Ù† Ø­Ø³Ø§Ø³Ø§Øª Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ ÙÙŠ Ø£Ø´Ù‡Ø± Ø§Ù„ÙˆØ¬Ù‡Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© Ø¨Ø§Ù„Ø£Ø±Ø¯Ù†.", insightTemp: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©", insightCrowd: "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ø²Ø¯Ø­Ø§Ù…", insightHumidity: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©", insightAir: "Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡",
                    mapTitle: "Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£Ø±Ø¯Ù† Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©", mapSubtitle: "Ø§Ø³ØªÙƒØ´Ù Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ø±Ø¯Ù† ÙˆØ®Ø·Ø· Ù…Ø³Ø§Ø±Ùƒ Ù…Ø¹ Ø®Ø±ÙŠØ·ØªÙ†Ø§ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©.",
                    categoriesTitle: "Ø§ÙƒØªØ´Ù Ø§Ù„Ø£Ø±Ø¯Ù† Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚ØªÙƒ", categoriesSubtitle: "Ø§Ø®ØªØ± Ù…Ù† Ø¨ÙŠÙ† ÙØ¦Ø§ØªÙ†Ø§ Ø§Ù„Ù…Ù†Ø³Ù‚Ø© Ù„ØªØ¬Ø¯ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„ØªÙŠ ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ.",
                    footerRights: "Â© 2024 SmartTour.JO. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.",
                    // Popups and others
                    yourLocationPopup: "<b>Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</b>", welcomePopup: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†!", thinking: "...Ù„Ø­Ø¸Ø© Ù…Ù† ÙØ¶Ù„Ùƒ"
                }
            };
            
            const categoriesData = {
                en: [
                    { id: 'nature', title: 'ğŸŒ¿ Nature', description: 'From the deserts of Wadi Rum to the waters of the Dead Sea.', image: 'https://images.pexels.com/photos/2356045/pexels-photo-2356045.jpeg'},
                    { id: 'culture', title: 'ğŸ›ï¸ Culture', description: 'Explore ancient Petra, Roman ruins of Jerash, and local traditions.', image: 'https://images.pexels.com/photos/3214958/pexels-photo-3214958.jpeg'},
                    { id: 'religious', title: 'â›ª Religious', description: 'Follow biblical paths to Mount Nebo, Bethany, and other sacred sites.', image: 'https://images.unsplash.com/photo-1619522165660-e4381de13158'},
                    { id: 'adventure', title: 'ğŸ§— Adventure', description: 'Desert camping, Red Sea diving, and canyoning adventures.', image: 'https://images.pexels.com/photos/1632790/pexels-photo-1632790.jpeg'}
                ],
                ar: [
                    { id: 'nature', title: 'ğŸŒ¿ Ø·Ø¨ÙŠØ¹Ø©', description: 'Ù…Ù† ØµØ­Ø±Ø§Ø¡ ÙˆØ§Ø¯ÙŠ Ø±Ù… Ø§Ù„Ø´Ø§Ø³Ø¹Ø© Ø¥Ù„Ù‰ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…ÙŠØª Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ©.', image: 'https://images.pexels.com/photos/2356045/pexels-photo-2356045.jpeg'},
                    { id: 'culture', title: 'ğŸ›ï¸ Ø«Ù‚Ø§ÙØ© ÙˆØªØ§Ø±ÙŠØ®', description: 'Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø¨ØªØ±Ø§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©ØŒ ÙˆØ¢Ø«Ø§Ø± Ø¬Ø±Ø´ Ø§Ù„Ø±ÙˆÙ…Ø§Ù†ÙŠØ©ØŒ ÙˆØ§Ù„ØªÙ‚Ø§Ù„ÙŠØ¯ Ø§Ù„Ù…Ø­Ù„ÙŠØ©.', image: 'https://images.pexels.com/photos/3214958/pexels-photo-3214958.jpeg'},
                    { id: 'religious', title: 'â›ª Ù…ÙˆØ§Ù‚Ø¹ Ø¯ÙŠÙ†ÙŠØ©', description: 'Ø§ØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ø³Ø© Ø¥Ù„Ù‰ Ø¬Ø¨Ù„ Ù†ÙŠØ¨Ùˆ ÙˆØ§Ù„Ù…ØºØ·Ø³ ÙˆØºÙŠØ±Ù‡Ø§ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù‡Ø§Ù…Ø©.', image: 'https://images.unsplash.com/photo-1619522165660-e4381de13158'},
                    { id: 'adventure', title: 'ğŸ§— Ù…ØºØ§Ù…Ø±Ø§Øª', description: 'ØªØ®ÙŠÙŠÙ… ÙÙŠ Ø§Ù„ØµØ­Ø±Ø§Ø¡ØŒ ØºÙˆØµ ÙÙŠ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±ØŒ ÙˆÙ…ØºØ§Ù…Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø£ÙˆØ¯ÙŠØ©.', image: 'https://images.pexels.com/photos/1632790/pexels-photo-1632790.jpeg'}
                ]
            };

            const setLanguage = (lang) => {
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
                localStorage.setItem('language', lang);

                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.getAttribute('data-translate');
                    el.textContent = translations[lang][key] || '';
                });

                document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
                    const key = el.getAttribute('data-translate-placeholder');
                    el.placeholder = translations[lang][key] || '';
                });

                document.getElementById('lang-ar').classList.toggle('active', lang === 'ar');
                document.getElementById('lang-en').classList.toggle('active', lang === 'en');
                
                populateCategories(lang);
                updateInsights();
            };
            
            // ===============================================
            // =========== 2. CORE FUNCTIONALITY =============
            // ===============================================

            // --- Populate Categories ---
            const categoriesGrid = document.querySelector('.categories-grid');
            function populateCategories(lang) {
                categoriesGrid.innerHTML = ''; // Clear existing cards
                categoriesData[lang].forEach(cat => {
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    card.innerHTML = `
                        <div class="category-image" style="background-image: url('${cat.image}')"></div>
                        <div class="category-content">
                            <h3 class="category-title">${cat.title}</h3>
                            <p>${cat.description}</p>
                        </div>
                    `;
                    categoriesGrid.appendChild(card);
                });
            }

            // --- IoT Insights ---
            function updateInsights() {
                const lang = document.documentElement.lang;
                const crowdLevels = { en: ["Low", "Medium", "High"], ar: ["Ù…Ù†Ø®ÙØ¶", "Ù…ØªÙˆØ³Ø·", "Ù…Ø±ØªÙØ¹"] };
                const airQualityLevels = { en: ["Good", "Moderate"], ar: ["Ø¬ÙŠØ¯Ø©", "Ù…ØªÙˆØ³Ø·Ø©"] };
                
                document.getElementById("temp").innerText = `${Math.floor(Math.random() * 12) + 22}`;
                document.getElementById("crowd").innerText = crowdLevels[lang][Math.floor(Math.random() * 3)];
                document.getElementById("humidity").innerText = `${Math.floor(Math.random() * 21) + 35}`;
                document.getElementById("air-quality").innerText = airQualityLevels[lang][Math.floor(Math.random() * 2)];
            }
            setInterval(updateInsights, 5000);

            // --- Interactive Map ---
            const map = L.map('map').setView([31.0, 36.5], 7);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const userLoc = [pos.coords.latitude, pos.coords.longitude];
                    map.setView(userLoc, 13);
                    L.marker(userLoc).addTo(map).bindPopup(translations[document.documentElement.lang].yourLocationPopup).openPopup();
                });
            }

            // --- Back to Top Button ---
            const backToTopBtn = document.getElementById('backToTop');
            window.addEventListener('scroll', () => {
                backToTopBtn.style.display = (window.scrollY > 300) ? 'flex' : 'none';
            });
            backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            
            // --- Language Switcher Events ---
            document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));
            document.getElementById('lang-ar').addEventListener('click', () => setLanguage('ar'));

            // --- Initial Load ---
            const savedLang = localStorage.getItem('language') || 'ar';
            setLanguage(savedLang);
        });

        // ===============================================
        // =========== 3. AI CHATBOT LOGIC ===============
        // ===============================================
        const chatWindow = document.getElementById('chatWindow');
        const inputElement = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        let chatHistory = [];

        function appendMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}-message`;
            messageDiv.innerText = message;
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        async function sendMessage() {
            const userInput = inputElement.value.trim();
            if (!userInput) return;

            appendMessage(userInput, 'user');
            chatHistory.push({ role: 'user', parts: [{ text: userInput }] });
            
            inputElement.value = '';
            sendButton.disabled = true;

            const lang = document.documentElement.lang;
            const thinkingText = translations[lang].thinking;
            const thinkingMessage = document.createElement('div');
            thinkingMessage.className = 'chat-message bot-message';
            thinkingMessage.innerText = thinkingText;
            chatWindow.appendChild(thinkingMessage);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            // !!! IMPORTANT !!!
            // REPLACE THIS URL WITH THE URL OF YOUR DEPLOYED BACKEND ON RENDER
            const apiUrl = "https://your-backend-api-url.onrender.com/chat";

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userInput, history: chatHistory }) // Send history for context
                });

                if (!response.ok) throw new Error(`Server error: ${response.status}`);
                
                const data = await response.json();
                const botResponse = data.reply;
                
                chatWindow.removeChild(thinkingMessage);
                appendMessage(botResponse, 'bot');
                chatHistory.push({ role: 'model', parts: [{ text: botResponse }] });

            } catch (error) {
                console.error("Chat API Error:", error);
                chatWindow.removeChild(thinkingMessage);
                appendMessage(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ø®Ù„ÙÙŠ ÙŠØ¹Ù…Ù„.`, 'bot');
            } finally {
                sendButton.disabled = false;
                inputElement.focus();
            }
        }
        
        inputElement.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendButton.disabled) sendMessage();
        });

    </script>
</body>
</html>